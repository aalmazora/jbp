!function($){function e(e){var a=$("#dmcm-"+i.hide),n=$("#dmcm-"+i.show);a.addClass("is-hidden").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(e).parents("ul").find("li.active").removeClass("active"),a.toggleClass("is-hidden hidden"),n.removeClass("hidden"),$(e).parent().addClass("active"),t(i.hide,i.show),i={},a.unbind()})}function t(e,t){var a=window.location.search.replace("panel="+e,"panel="+t),n=window.location.pathname+a;window.history.replaceState(null,null,n)}function a(e,t,a,n){var i=document.createElement("tr"),s=document.createElement("a"),r=document.createElement("a"),d=document.createElement("td"),l=document.createElement("td"),o=document.createElement("td"),c=document.createElement("td"),p=document.createElement("td");return i.setAttribute("data-id",e),d.innerHTML=e,o.innerHTML=t,c.innerHTML=a,s.href="admin.php?page=dmcm_products&action=edit&dmcm_id="+e,s.text=n,r.href="#",r.text="[x]",r.classList.add("dmcm-related-products-remove-row"),r.dataset.pid=e,l.appendChild(s),p.appendChild(r),i.appendChild(d),i.appendChild(l),i.appendChild(o),i.appendChild(c),i.appendChild(p),i}function n(){var e=jQuery(".js-related-sortable-container").children("tr").map(function(){return jQuery(this).attr("data-id")}).get().join(";");jQuery("#dmcm-related-products-field").val(e)}$.fn.goTo=function(e){var t="undefined"!=typeof e?0:$(this).offset().top-50;return $("html, body").animate({scrollTop:t+"px"},"slow"),this},$(document).on("click",".js-open-form",function(e){e.preventDefault(),$("#js-import").toggleClass("is-visible is-hidden")});var i={};$(document).on("click",".js-dmcm-panel-nav-link",function(t){return t.preventDefault(),$(this).parent().hasClass("active")?!1:(i.show=$(this).parent().data("panel"),i.hide=$(this).parents("ul").find("li.active").data("panel"),void e(t.target||t.srcElement))}),$(document).on("click",".js-dmcm-remove-image",function(e){e.preventDefault();var t=$(this).data(),a=t.name,n=t.path,i=t.position,s=document.createElement("input"),r=$(this).siblings("input[type=hidden]");r.val(""),s.name="delete_"+a+"["+i+"]",s.type="hidden",s.value=n,$(this).siblings("img").addClass("to-remove"),$(this).next().find("input[type=file]").removeAttr("disabled").on("change",function(){r.val($(this).val().toLowerCase().split("fakepath\\")[1])}),$(this).parent().append(s)}),$(document).on("change",".js-dmcm-select-image",function(){var e=$(this).val().split("fakepath\\")[1];$(this).siblings("input[type=hidden]").val(e)}),$(document).on("click",".dmcm-related-product-link",function(e){e.preventDefault();var t=e.target||e.scrElement,n=document.querySelector("#dmcm-related-products-field"),i=document.querySelector("#dmcm-related-products-table"),s,r,d,l;return t.classList.contains("disabled")?!1:(s=t.dataset.pid,r=t.dataset.sku,l=t.dataset.active,d=t.innerHTML,t.classList.add("disabled"),n.value+=";"+s,$(i).find("tbody").append(a(s,r,l,d)),!0)}),$(document).on("click",".dmcm-related-products-remove-row",function(e){e.preventDefault();var t=e.target||e.scrElement,a=document.querySelector("#dmcm-related-products-field"),n=t.parentNode.parentNode,i=t.dataset.pid,s=a.value.split(";"),r=s.indexOf(i);return s.splice(r,1),a.value=s.toString().replace(new RegExp(",","g"),";"),n.remove(),$('a[data-pid="'+i+'"').removeClass("disabled"),!0}),jQuery(".js-related-sortable-container").sortable({update:function(){n()}}),$("#js-csv-import-file-trigger").on("click",function(e){e.preventDefault(),$("#js-csv-import-file-input").click()}),$("#js-csv-import-file-input").on("change",function(e){e.preventDefault(),$("#js-csv-import-file-name").text(this.value.split("fakepath\\")[1])}),$(".js-dmcm-importer-type").on("click",function(e){e.preventDefault();var t="admin.php?page=dmcm_importer&action=export",a,n,i;$(this).hasClass("active")||($(this).siblings("a").hasClass("active")?$(this).siblings("a").removeClass("active"):($("#js-import, #js-export").toggleClass("hidden is-hidden"),setTimeout(function(){$("#js-import, #js-export").removeClass("is-hidden")},0)),a=$(this).data("type"),$(this).addClass("active"),$("#js-csv-import-file-type").attr("value",a),$(".js-export-all").attr("data-type",a),$(".js-export-template").attr("data-type",a),$(".js-type").text("("+a+")"),n=$(".js-export-all").attr("href",t+"&type=all&module="+a),i=$(".js-export-template").attr("href",t+"&type=template&module="+a))}),$(".js-get-features").on("click",function(e){var t=$(this).data("link"),a=$(this).siblings(".spinner"),n=$(this).parents("tr");n.addClass("active-row"),a.toggleClass("is-active"),$(".js-ajax-features").empty(),e.preventDefault(),$.post(ajaxurl,{action:"exec",model:"vehicle",method:"getProductFeatures",params:{link_id:t,toHtml:1}},function(e){a.toggleClass("is-active"),$(".js-ajax-features").append(e).goTo()})}),$(document).on("click","#js-cancel-features",function(e){e.preventDefault(),$(".js-ajax-features").empty(),$(".active-row").goTo("top").removeClass("active-row")}),$(document).on("click","#js-save-features",function(e){e.preventDefault();var t=$(".js-feature-field"),a=$(this).siblings(".spinner"),n={},i,s,r,d;a.toggleClass("is-active"),$(".js-data").css({opacity:".5"});for(var l=0;l<t.length;l++)i=$(t[l]),s=i.attr("name").replace("features[","").replace("]",""),d=i.val(),"feature_id"!==s?n[s]=d:r=d;$.post(ajaxurl,{action:"exec",model:"vehicle",method:"saveFeatures",params:{feature_id:r,data:n}},function(e){a.toggleClass("is-active"),e=$.parseJSON(e),"success"===e.status&&($(".js-ajax-features").empty().text("Features Saved Successfully."),$(".active-row").goTo().removeClass("active-row").addClass("updated-row"))})})}(jQuery);