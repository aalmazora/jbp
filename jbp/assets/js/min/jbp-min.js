!function(x){x.fn.goTo=function(e){var t=void 0!==e?0:x(this).offset().top-50;return x("html, body").animate({scrollTop:t+"px"},"slow"),this},x(document).on("click",".js-open-form",function(e){e.preventDefault(),x("#js-import").toggleClass("is-visible is-hidden")});var o={};function t(n){var s=x("#jbp-"+o.hide),r=x("#jbp-"+o.show);s.addClass("is-hidden").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){var e,t,a,i;x(n).parents("ul").find("li.active").removeClass("active"),s.toggleClass("is-hidden hidden"),r.removeClass("hidden"),x(n).parent().addClass("active"),e=o.hide,t=o.show,a=window.location.search.replace("panel="+e,"panel="+t),i=window.location.pathname+a,window.history.replaceState(null,null,i),o={},s.unbind()})}x(document).on("click",".js-jbp-panel-nav-link",function(e){if(e.preventDefault(),x(this).parent().hasClass("active"))return!1;o.show=x(this).parent().data("panel"),o.hide=x(this).parents("ul").find("li.active").data("panel"),t(e.target||e.srcElement)}),x(document).on("click",".js-jbp-remove-image",function(e){e.preventDefault();var t=x(this).data(),a=t.name,i=t.path,n=t.position,s=document.createElement("input"),r=x(this).siblings("input[type=hidden]");r.val(""),s.name="delete_"+a+"["+n+"]",s.type="hidden",s.value=i,x(this).siblings("img").addClass("to-remove"),x(this).next().find("input[type=file]").removeAttr("disabled").on("change",function(){r.val(x(this).val().toLowerCase().split("fakepath\\")[1])}),x(this).parent().append(s)}),x(document).on("change",".js-jbp-select-image",function(){var e=x(this).val().split("fakepath\\")[1];x(this).siblings("input[type=hidden]").val(e)}),x(document).on("click",".jbp-related-product-link",function(e){e.preventDefault();var t,a,i,n,s,r,o,d,l,p,c,u,v,m,h,f,j=e.target||e.scrElement,g=document.querySelector("#jbp-related-products-field"),b=document.querySelector("#jbp-related-products-table");return!j.classList.contains("disabled")&&(t=j.dataset.pid,a=j.dataset.sku,n=j.dataset.active,i=j.innerHTML,j.classList.add("disabled"),g.value+=";"+t,x(b).find("tbody").append((s=t,r=a,o=n,d=i,l=document.createElement("tr"),p=document.createElement("a"),c=document.createElement("a"),u=document.createElement("td"),v=document.createElement("td"),m=document.createElement("td"),h=document.createElement("td"),f=document.createElement("td"),l.setAttribute("data-id",s),u.innerHTML=s,m.innerHTML=r,h.innerHTML=o,p.href="admin.php?page=jbp_products&action=edit&jbp_id="+s,p.text=d,c.href="#",c.text="[x]",c.classList.add("jbp-related-products-remove-row"),c.dataset.pid=s,v.appendChild(p),f.appendChild(c),l.appendChild(u),l.appendChild(v),l.appendChild(m),l.appendChild(h),l.appendChild(f),l)),!0)}),x(document).on("click",".jbp-related-products-remove-row",function(e){e.preventDefault();var t=e.target||e.scrElement,a=document.querySelector("#jbp-related-products-field"),i=t.parentNode.parentNode,n=t.dataset.pid,s=a.value.split(";"),r=s.indexOf(n);return s.splice(r,1),a.value=s.toString().replace(new RegExp(",","g"),";"),i.remove(),x('a[data-pid="'+n+'"').removeClass("disabled"),!0}),jQuery(".js-related-sortable-container").sortable({update:function(){var e;e=jQuery(".js-related-sortable-container").children("tr").map(function(){return jQuery(this).attr("data-id")}).get().join(";"),jQuery("#jbp-related-products-field").val(e)}}),x("#js-csv-import-file-trigger").on("click",function(e){e.preventDefault(),x("#js-csv-import-file-input").click()}),x("#js-csv-import-file-input").on("change",function(e){e.preventDefault(),x("#js-csv-import-file-name").text(this.value.split("fakepath\\")[1]),x("#js-csv-import .button-hero").prop("disabled",!1)}),x(".js-jbp-importer-type").on("click",function(e){e.preventDefault();var t,a="admin.php?page=jbp_importer&action=export";x(this).hasClass("active")||x(this).attr("disabled")||(x(this).siblings("a").hasClass("active")?x(this).siblings("a").removeClass("active"):(x("#js-import, #js-export").toggleClass("hidden is-hidden"),setTimeout(function(){x("#js-import, #js-export").removeClass("is-hidden")},0)),t=x(this).data("type"),x(this).addClass("active"),x("#js-csv-import-file-type").attr("value",t),x(".js-export-all").attr("data-type",t),x(".js-export-template").attr("data-type",t),x(".js-type").text("("+t+")"),x(".js-export-all").attr("href",a+"&type=all&module="+t),x(".js-export-template").attr("href",a+"&type=template&module="+t))}),x(document).on("click",".js-get-features",function(e){var t=x(this).data("link"),a=x(this).siblings(".spinner");x(this).parents("tr").addClass("active-row"),a.toggleClass("is-active"),x(".js-ajax-features").empty(),e.preventDefault(),x.post(ajaxurl,{action:"exec",model:"vehicle",method:"getProductFeatures",params:{link_id:t,toHtml:1}},function(e){a.toggleClass("is-active"),x(".js-ajax-features").append(e).goTo()})}),x(document).on("click","#js-cancel-features",function(e){e.preventDefault(),x(".js-ajax-features").empty(),x(".active-row").goTo("top").removeClass("active-row")}),x(document).on("click","#js-save-features",function(e){e.preventDefault();var t,a,i,n,s=x(".js-feature-field"),r=x(this).siblings(".spinner"),o={};r.toggleClass("is-active"),x(".js-data").css({opacity:".5"});for(var d=0;d<s.length;d++)a=(t=x(s[d])).attr("name").replace("features[","").replace("]",""),n=t.val(),"feature_id"!==a?o[a]=n:i=n;x.post(ajaxurl,{action:"exec",model:"vehicle",method:"saveFeatures",params:{feature_id:i,data:o}},function(e){r.toggleClass("is-active"),"success"===(e=x.parseJSON(e)).status&&(x(".js-ajax-features").empty().text("Features Saved Successfully."),x(".active-row").goTo().removeClass("active-row").addClass("updated-row"))})});var n=!1;x(document).on("click",".js-remove-pairing",function(e){e.preventDefault();var t=x(this).siblings(".spinner"),a=x(this).parents("tr");if(t.toggleClass("is-active"),!n){if(!confirm("Are you sure you want to delete this application? This action can't be undone."))return t.toggleClass("is-active"),!1;n=!0}var i=x(this).data("link");x.post(ajaxurl,{action:"exec",model:"vehicle",method:"removePairing",params:{link_id:i}},function(e){a.fadeOut(400,function(){a.remove()})})}),x("#js-add-pairings").on("click",function(e){e.preventDefault();for(var t=x(".js-products:checked").toArray(),a=x("#js-vehicle-id").val(),i=[],n=[],s=0;s<t.length;s++)i[s]=x(t[s]).val(),n[s]={id:x(t[s]).val(),name:x(t[s]).siblings("label").text()};x.post(ajaxurl,{action:"exec",model:"vehicle",method:"addPairings",params:{products:i,vehicle_id:a}},function(e){e=JSON.parse(e),function(e,t){for(var a,i,n,s,r,o,d,l,p,c,u=x('<span class="spinner"></span>'),v=x("#jbp-pairings-table"),m=0;m<t.length;m++){for(var h in a=t[m],e)if(e[h].id==a.product_id){n=e[h].id,s=e[h].name;break}i=x("<tr />"),r=x("<td />"),o=x("<td />"),d=x("<td />"),l=x("<td />"),p=x("<a />"),c=x("<a />"),r.text(n),o.text(s),p.attr("href","#"),p.addClass("js-get-features"),p.attr("data-link",a.link_id),p.text("[view]"),d.append(p),d.append(u),c.attr("href","#"),c.addClass("js-remove-pairing"),c.attr("data-link",a.link_id),c.text("[x]"),l.append(c),l.append(u),i.addClass("new-row"),i.append(r),i.append(o),i.append(d),i.append(l),v.append(i)}v.goTo("top")}(n,e.pairings)})}),x("#js-remove-vehicle").on("click",function(e){e.preventDefault();var t=x(this).data("id");if(!confirm("This operation can't be undone. Do you want to continue?"))return!1;console.log("removing vehicle id: "+t),x.post(ajaxurl,{action:"exec",model:"vehicle",method:"removeVehicle",params:{vehicle_id:t}},function(e){(e=JSON.parse(e)).hasOwnProperty("redirect")&&(window.location.href=e.redirect)})})}(jQuery);